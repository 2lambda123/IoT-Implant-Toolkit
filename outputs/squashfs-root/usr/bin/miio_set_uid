#!/bin/sh

[ ! -f "/data/status/dhcp_done" ] && exit 1
ssid=`cat /data/wifi/wpa_supplicant.conf | grep ssid | cut -d '=' -f 2`
[ ! -n "$ssid" ] && exit 1
psk=`cat /data/wifi/wpa_supplicant.conf | grep psk | cut -d '=' -f 2`
ubus wait_for miio
(
    ubus -t 3 call miio register "{\"ssid\":$ssid, \"psk\":$psk}"
)
