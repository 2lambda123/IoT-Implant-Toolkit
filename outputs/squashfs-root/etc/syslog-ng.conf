@version:3.0

options {
	chain_hostnames(no);
	create_dirs(yes);
	flush_lines(0);
	keep_hostname(no);
	log_fifo_size(256);
	log_msg_size(1024);
	stats_freq(0);
	flush_lines(0);
	use_fqdn(no);
	use_dns(no);
	dns_cache(no);
	keep_timestamp(no);
	send-time-zone(+08:00);
};

source src {
	internal();
	unix-dgram("/dev/log");
};

source kernel {
        file("/proc/kmsg" program_override("kernel") flags(no-parse));
};

source miio {
	pipe("/var/run/miio_log" program_override("miio_client") flags(no-parse));
};

destination messages {
	file("/var/log/messages");
};

filter f_messages {
       	level(alert .. warning)
	or program("miio_client")
	or program("kernel");
};

log {
	source(src);
        source(kernel);
	source(miio);
	filter(f_messages);
	destination(messages);
};

destination d_state_points {
	file("/var/log/sp.log");
};

filter f_state_points {
       match("state_points_" value("MESSAGE"));
};

log {
	source(src);
	filter(f_state_points);
	destination(d_state_points);
};

template t_stat { template("$MSG\n"); };

destination d_stat_points_rom {
	file("/tmp/stat_points_rom.log" template(t_stat));
};

filter f_stat_points_rom {
	(match("stat_points_none" value("MESSAGE"))
	or match("stat_points_instant" value("MESSAGE")));
};

log {
	source(src);
	filter(f_stat_points_rom);
	destination(d_stat_points_rom);
};
